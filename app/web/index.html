<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OTORI</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Leaflet.js for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <pre class="ascii-logo"> ██████╗ ████████╗ ██████╗ ██████╗ ██╗
██╔═══██╗╚══██╔══╝██╔═══██╗██╔══██╗██║
██║   ██║   ██║   ██║   ██║██████╔╝██║
██║   ██║   ██║   ██║   ██║██╔══██╗██║
╚██████╔╝   ██║   ╚██████╔╝██║  ██║██║
 ╚═════╝    ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚═╝</pre>
      </div>
      <nav class="header-nav">
        <button class="nav-btn active" data-page="overview" data-i18n="nav.overview">Vue d'ensemble</button>
        <button class="nav-btn" data-page="geography" data-i18n="nav.geography">Géographie</button>
        <button class="nav-btn" data-page="analytics" data-i18n="nav.analytics">Analyse</button>
        <button class="nav-btn" data-page="sessions" data-i18n="nav.sessions">Sessions</button>
      </nav>
      <div class="header-spacer"></div>
      <div class="header-actions">
        <button class="lang-btn" id="lang-toggle" onclick="toggleLanguage()">FR</button>
        <button class="settings-btn" onclick="alert('Settings coming soon!')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </button>
      </div>
    </header>

    <!-- Page: Overview -->
    <div id="page-overview" class="page active">
      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card clickable" onclick="showAllSessions()">
          <div class="label" data-i18n="kpi.totalSessions">Total Sessions</div>
          <div class="value accent" id="kpi-sessions">0</div>
          <div class="sub" data-i18n="kpi.last24h">dernières 24h</div>
        </div>
        <div class="kpi-card clickable" onclick="showTopIpsModal()">
          <div class="label" data-i18n="kpi.uniqueIps">IPs Uniques</div>
          <div class="value blue" id="kpi-ips">0</div>
          <div class="sub" data-i18n="kpi.distinctAttackers">attaquants distincts</div>
        </div>
        <div class="kpi-card clickable" onclick="showTopCommandsModal()">
          <div class="label" data-i18n="kpi.commands">Commandes</div>
          <div class="value" id="kpi-commands">0</div>
          <div class="sub"><span id="kpi-cmds-session">0</span> <span data-i18n="kpi.perSession">par session</span></div>
        </div>
        <div class="kpi-card clickable" onclick="showSessionsByDuration()">
          <div class="label" data-i18n="kpi.avgDuration">Durée Moyenne</div>
          <div class="value green" id="kpi-duration">0s</div>
          <div class="sub" data-i18n="kpi.perSession">par session</div>
        </div>
      </div>

      <!-- Activity Chart -->
      <div class="section-title" data-i18n="section.activityTimeline">Chronologie d'activité</div>
      <div class="card" style="margin-bottom: 40px;">
        <div class="card-title">
          Sessions & Commandes
          <span class="badge" id="timeline-total">0 sessions</span>
        </div>
        <div class="chart-container">
          <canvas id="activityChart"></canvas>
        </div>
      </div>

      <!-- Two columns -->
      <div class="grid-2">
        <div class="card">
          <div class="card-title" data-i18n="card.authentication">Authentification</div>
          <div class="chart-container medium">
            <canvas id="loginChart"></canvas>
          </div>
          <div class="stats-row">
            <div class="stat-item clickable" onclick="showAuthDetails('success')">
              <div class="stat-value" style="color: var(--green)" id="login-success">0</div>
              <div class="stat-label" data-i18n="auth.success">Succès</div>
            </div>
            <div class="stat-item clickable" onclick="showAuthDetails('failed')">
              <div class="stat-value" style="color: var(--red)" id="login-failed">0</div>
              <div class="stat-label" data-i18n="auth.failed">Échecs</div>
            </div>
            <div class="stat-item clickable" onclick="showAuthDetails('all')">
              <div class="stat-value" id="unique-usernames">0</div>
              <div class="stat-label" data-i18n="auth.usernames">Identifiants</div>
            </div>
            <div class="stat-item clickable" onclick="showAuthDetails('all')">
              <div class="stat-value" id="unique-passwords">0</div>
              <div class="stat-label" data-i18n="auth.passwords">Mots de passe</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-title" data-i18n="card.topIps">Top IPs</div>
          <div class="top-list" id="top-ips"></div>
        </div>
      </div>
    </div>

    <!-- Page: Geography -->
    <div id="page-geography" class="page">
      <!-- Geo KPIs -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="label" data-i18n="geo.uniqueCountries">Pays uniques</div>
          <div class="value blue" id="kpi-countries">0</div>
          <div class="sub" data-i18n="geo.origins">origines distinctes</div>
        </div>
        <div class="kpi-card">
          <div class="label" data-i18n="geo.topCountry">Pays #1</div>
          <div class="value accent" id="kpi-top-country">-</div>
          <div class="sub" id="kpi-top-country-sessions">0 sessions</div>
        </div>
        <div class="kpi-card">
          <div class="label" data-i18n="geo.attackPoints">Points d'attaque</div>
          <div class="value green" id="kpi-attack-points">0</div>
          <div class="sub" data-i18n="geo.geolocated">géolocalisés</div>
        </div>
        <div class="kpi-card">
          <div class="label" data-i18n="geo.topAsn">Top ASN</div>
          <div class="value purple" id="kpi-top-asn">-</div>
          <div class="sub" id="kpi-top-asn-sessions">0 sessions</div>
        </div>
      </div>

      <!-- World Map -->
      <div class="section-title" data-i18n="geo.attackMap">Carte des attaques</div>
      <div class="card map-card">
        <div class="card-title">
          <span data-i18n="geo.globalView">Vue globale</span>
          <div class="map-legend">
            <span class="legend-item"><span class="legend-dot critical"></span> Critical</span>
            <span class="legend-item"><span class="legend-dot high"></span> High</span>
            <span class="legend-item"><span class="legend-dot medium"></span> Medium</span>
            <span class="legend-item"><span class="legend-dot low"></span> Low</span>
          </div>
        </div>
        <div id="attack-map" class="map-container"></div>
      </div>

      <!-- Two columns: Countries and ASN -->
      <div class="grid-2" style="margin-top: 24px;">
        <div class="card">
          <div class="card-title" data-i18n="geo.topCountries">Top Pays</div>
          <div class="top-list" id="top-countries-list"></div>
        </div>
        <div class="card">
          <div class="card-title" data-i18n="geo.topAsns">Top ASN / Opérateurs</div>
          <div class="top-list" id="top-asn-list"></div>
        </div>
      </div>
    </div>

    <!-- Page: Sessions -->
    <div id="page-sessions" class="page">
      <!-- Filter Panel -->
      <div class="filter-panel" id="filter-panel">
        <div class="filter-header" onclick="toggleFilters()">
          <div class="filter-title">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
            </svg>
            <span data-i18n="filter.title">Filtres</span>
          </div>
          <div class="filter-summary" id="filter-summary"></div>
          <button class="filter-toggle" id="filter-toggle">&#9660;</button>
        </div>

        <div class="filter-content" id="filter-content">
          <!-- Row 1: IP, Username, Country -->
          <div class="filter-row">
            <div class="filter-group">
              <label data-i18n="filter.ip">IP</label>
              <input type="text" id="filter-ip" placeholder="192.168..." oninput="onFilterChange()">
            </div>
            <div class="filter-group">
              <label data-i18n="filter.username">Identifiant</label>
              <input type="text" id="filter-username" placeholder="root, admin..." oninput="onFilterChange()">
            </div>
            <div class="filter-group">
              <label data-i18n="filter.country">Pays</label>
              <div class="filter-dropdown" id="country-dropdown">
                <div class="dropdown-trigger" onclick="toggleCountryDropdown(event)">
                  <span id="country-dropdown-text" data-i18n="filter.allCountries">Tous les pays</span>
                  <span>&#9662;</span>
                </div>
                <div class="dropdown-menu" id="country-dropdown-menu"></div>
              </div>
            </div>
          </div>

          <!-- Row 2: Danger Level, Attacker Type -->
          <div class="filter-row">
            <div class="filter-group filter-group-wide">
              <label data-i18n="filter.dangerLevel">Niveau de danger</label>
              <div class="checkbox-group" id="danger-level-group">
                <label class="filter-badge critical">
                  <input type="checkbox" value="critical" checked onchange="onFilterChange()">
                  Critical
                </label>
                <label class="filter-badge high">
                  <input type="checkbox" value="high" checked onchange="onFilterChange()">
                  High
                </label>
                <label class="filter-badge medium">
                  <input type="checkbox" value="medium" checked onchange="onFilterChange()">
                  Medium
                </label>
                <label class="filter-badge low">
                  <input type="checkbox" value="low" checked onchange="onFilterChange()">
                  Low
                </label>
                <label class="filter-badge minimal">
                  <input type="checkbox" value="minimal" checked onchange="onFilterChange()">
                  Minimal
                </label>
              </div>
            </div>
            <div class="filter-group">
              <label data-i18n="filter.attackerType">Type d'attaquant</label>
              <div class="checkbox-group" id="attacker-type-group">
                <label class="filter-badge bot">
                  <input type="checkbox" value="bot" checked onchange="onFilterChange()">
                  Bot
                </label>
                <label class="filter-badge human">
                  <input type="checkbox" value="human" checked onchange="onFilterChange()">
                  Human
                </label>
                <label class="filter-badge hybrid">
                  <input type="checkbox" value="hybrid" checked onchange="onFilterChange()">
                  Hybrid
                </label>
                <label class="filter-badge unknown">
                  <input type="checkbox" value="unknown" checked onchange="onFilterChange()">
                  Unknown
                </label>
              </div>
            </div>
          </div>

          <!-- Row 3: Score Range, Command Count, Honeypot Type -->
          <div class="filter-row">
            <div class="filter-group">
              <label data-i18n="filter.scoreRange">Score (0-100)</label>
              <div class="range-inputs">
                <input type="number" id="filter-score-min" min="0" max="100" value="0" onchange="onFilterChange()">
                <span>-</span>
                <input type="number" id="filter-score-max" min="0" max="100" value="100" onchange="onFilterChange()">
              </div>
            </div>
            <div class="filter-group">
              <label data-i18n="filter.cmdCount">Commandes</label>
              <div class="range-inputs">
                <input type="number" id="filter-cmd-min" min="0" placeholder="Min" onchange="onFilterChange()">
                <span>-</span>
                <input type="number" id="filter-cmd-max" min="0" placeholder="Max" onchange="onFilterChange()">
              </div>
            </div>
            <div class="filter-group">
              <label data-i18n="filter.honeypotType">Type Honeypot</label>
              <div class="segment-control" id="honeypot-segment">
                <button class="segment-btn active" data-value="all" onclick="setHoneypotFilter('all')" data-i18n="filter.all">Tous</button>
                <button class="segment-btn" data-value="classic" onclick="setHoneypotFilter('classic')">Classic</button>
                <button class="segment-btn" data-value="ia" onclick="setHoneypotFilter('ia')">IA</button>
              </div>
            </div>
          </div>

          <!-- Row 4: Flags and Reset -->
          <div class="filter-row">
            <div class="filter-group">
              <label data-i18n="filter.flags">Indicateurs</label>
              <div class="checkbox-group">
                <label class="filter-checkbox">
                  <input type="checkbox" id="filter-persistence" onchange="onFilterChange()">
                  <span data-i18n="filter.persistence">Persistence</span>
                </label>
                <label class="filter-checkbox">
                  <input type="checkbox" id="filter-credential" onchange="onFilterChange()">
                  <span data-i18n="filter.credential">Credential Access</span>
                </label>
              </div>
            </div>
            <div class="filter-actions">
              <button class="btn-secondary" onclick="resetFilters()" data-i18n="filter.reset">Reinitialiser</button>
              <span id="filter-result-count"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="table-card">
        <div class="table-header">
          <div class="table-title" data-i18n="table.allSessions">Toutes les Sessions</div>
          <span id="session-count" style="color: var(--muted); font-size: 13px;">0 sessions</span>
        </div>
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th data-i18n="table.sourceIp">IP Source</th>
                <th data-i18n="table.country">Pays</th>
                <th data-i18n="table.username">Identifiant</th>
                <th data-i18n="table.cmds">Cmds</th>
                <th data-i18n="table.dangerScore" data-i18n-tooltip="tooltip.dangerScore">Score de danger</th>
                <th data-i18n="table.level">Niveau</th>
                <th data-i18n="table.attacker">Attaquant</th>
                <th data-i18n="table.duration">Durée</th>
              </tr>
            </thead>
            <tbody id="sessions-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Page: Analytics -->
    <div id="page-analytics" class="page">
      <!-- Analytics KPIs -->
      <div class="kpi-grid">
        <div class="kpi-card clickable" onclick="showSeverityDetails('critical')">
          <div class="label" data-i18n="kpi.criticalCmds">Commandes Critiques</div>
          <div class="value red" id="kpi-critical">0</div>
          <div class="sub" data-i18n="kpi.criticalLevel">niveau critique</div>
        </div>
        <div class="kpi-card clickable" onclick="showHighDangerSessions()">
          <div class="label" data-i18n="kpi.highSessions">Sessions High+</div>
          <div class="value orange" id="kpi-high-sessions">0</div>
          <div class="sub" data-i18n="kpi.highDanger">danger élevé</div>
        </div>
        <div class="kpi-card clickable" onclick="showAllMitreTechniques()">
          <div class="label" data-i18n="kpi.mitreTechniques">Techniques MITRE</div>
          <div class="value purple" id="kpi-mitre">0</div>
          <div class="sub" data-i18n="kpi.detected">détectées</div>
        </div>
        <div class="kpi-card clickable" onclick="showAttackerTypeDetails()">
          <div class="label" data-i18n="kpi.botRatio">Ratio Bots</div>
          <div class="value blue" id="kpi-bot-ratio">0%</div>
          <div class="sub" data-i18n="kpi.vsHumans">vs humains</div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="section-title" data-i18n="section.threatDistribution">Distribution des menaces</div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title" data-i18n="card.attackCategories">Catégories d'Attaque</div>
          <div class="chart-container medium">
            <canvas id="categoryChart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-title" data-i18n="card.cmdSeverity">Sévérité des Commandes</div>
          <div class="chart-container medium">
            <canvas id="severityChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Bottom Row -->
      <div class="section-title" data-i18n="section.detailedAnalysis">Analyse détaillée</div>
      <div class="grid-3">
        <div class="card">
          <div class="card-title" data-i18n="card.dangerousCmds">Commandes les plus dangereuses</div>
          <div class="top-list" id="top-dangerous"></div>
        </div>
        <div class="card">
          <div class="card-title" data-i18n="card.mitreTechniques">Techniques MITRE ATT&CK</div>
          <div class="top-list" id="top-mitre"></div>
        </div>
        <div class="card">
          <div class="card-title" data-i18n="card.topPasswords">Mots de passe fréquents</div>
          <div class="top-list" id="top-passwords"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Generic Detail Modal -->
  <div class="detail-modal-overlay" id="detail-modal" onclick="closeDetailModal(event)">
    <div class="detail-modal" onclick="event.stopPropagation()">
      <div class="detail-modal-header">
        <div class="detail-modal-title">
          <span class="icon" id="detail-modal-icon"></span>
          <span id="detail-modal-title-text">Details</span>
        </div>
        <button class="modal-close" onclick="closeDetailModal()">&times;</button>
      </div>
      <div class="detail-modal-body" id="detail-modal-body">
        <div class="detail-modal-loading">Chargement...</div>
      </div>
    </div>
  </div>

  <!-- IP Detail Modal -->
  <div class="modal-overlay" id="ip-modal" onclick="closeIpModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-header-left">
          <span class="modal-ip" id="modal-ip"></span>
          <div class="modal-country">
            <span class="flag" id="modal-flag"></span>
            <span id="modal-country-name"></span>
          </div>
        </div>
        <div style="display: flex; gap: 12px; align-items: center;">
          <button class="btn-secondary" onclick="filterByModalIP()" data-i18n="modal.filterByIp">Filtrer par cette IP</button>
          <button class="modal-close" onclick="closeIpModal()">&times;</button>
        </div>
      </div>
      <div class="modal-body">
        <!-- KPI Summary -->
        <div class="modal-kpi-grid">
          <div class="modal-kpi">
            <div class="value accent" id="modal-sessions-count">0</div>
            <div class="label" data-i18n="modal.sessions">Sessions</div>
          </div>
          <div class="modal-kpi">
            <div class="value blue" id="modal-commands-count">0</div>
            <div class="label" data-i18n="modal.commands">Commandes</div>
          </div>
          <div class="modal-kpi">
            <div class="value" id="modal-avg-score">0</div>
            <div class="label" data-i18n="modal.avgScore">Score moyen</div>
          </div>
          <div class="modal-kpi">
            <div class="value green" id="modal-total-duration">0s</div>
            <div class="label" data-i18n="modal.totalDuration">Durée totale</div>
          </div>
          <div class="modal-kpi">
            <div class="value purple" id="modal-usernames-count">0</div>
            <div class="label" data-i18n="modal.usernames">Identifiants</div>
          </div>
        </div>

        <!-- Main Content Grid -->
        <div class="modal-grid-2">
          <!-- Left Column -->
          <div>
            <!-- Danger Level Distribution -->
            <div class="modal-section">
              <div class="modal-section-title" data-i18n="modal.dangerDistribution">Distribution des niveaux de danger</div>
              <div class="modal-card">
                <div class="danger-distribution" id="modal-danger-distribution"></div>
              </div>
            </div>

            <!-- Sessions List -->
            <div class="modal-section">
              <div class="modal-section-title" data-i18n="modal.sessionsList">Sessions de cette IP</div>
              <div class="modal-card">
                <div class="modal-sessions-list" id="modal-sessions-list"></div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <!-- Attacker Type & Honeypot -->
            <div class="modal-section">
              <div class="modal-section-title" data-i18n="modal.attackProfile">Profil d'attaque</div>
              <div class="modal-card">
                <div id="modal-attack-profile"></div>
              </div>
            </div>

            <!-- Top Commands -->
            <div class="modal-section">
              <div class="modal-section-title" data-i18n="modal.topCommands">Commandes les plus utilisées</div>
              <div class="modal-card">
                <div class="modal-commands-list" id="modal-commands-list"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Usernames Used -->
        <div class="modal-section">
          <div class="modal-section-title" data-i18n="modal.usernamesUsed">Identifiants utilisés</div>
          <div class="modal-card">
            <div class="checkbox-group" id="modal-usernames-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Files (order matters) -->
  <script src="js/utils.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/charts.js"></script>
  <script src="js/map.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/detail-handlers.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
